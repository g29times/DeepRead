
# DeepRead 金句热力 UI 设计稿（文章内联 / 静态 Mock）

## 目标

在**真实完整文章页面**内呈现“金句关注”与“金句之间的关联强弱”，让用户在阅读流不被打断的情况下：

- 看到自己标注的金句在全文中的分布
- 点击某条金句后，快速看到它与其它金句的关联（强弱 + 位置）
- 通过“跳转/切换中心句”形成一种可视化的复盘路径，而不只是划线

## MVP 选择（本次确定的方案）

- **触发方式**：`click`（点击正文中的金句）
- **信息承载**：右侧固定栏（关联句列表 + 热力条 + 操作按钮）
- **分布感知**：左侧文章卡尺（mini-map，标出金句位置，选中时点亮相关句）
- **关系强度来源**：先用**手动标注/默认等强**（用于 UI 体验验证），后续可接入 embedding 等自动计算

对应实现 mock 文件：`heatmap-article-mock.html`

## 页面布局

三栏布局（从左到右）：

- **左侧：卡尺 mini-map**
  - 一条垂直条带，按文章高度映射
  - 每个金句对应一个“刻度点”（dot）
  - 显示当前视口范围（viewport window）
- **中间：真实文章正文**
  - 正文完整保留段落结构
  - 金句用内联元素包裹（类似划线效果）
- **右侧：关联固定栏**
  - 展示当前选中金句
  - 展示关联金句列表（卡片）
  - 每条关联金句包含热力条与操作按钮

## 核心交互与状态

### 1. 选中/取消选中

- **点击某条金句**：设置为“中心句”（selected）
- **再次点击同一条**：取消选中（回到默认状态）
- **点击顶部 `取消选中` 按钮**：取消选中

### 2. 选中后页面响应

当选中中心句 `A`：

- **正文区域**
  - `A` 进入 `is-selected`
  - 与 `A` 相关的其它句 `B/C/...` 进入 `is-related`
  - 若权重更高（例如 `>= 0.80`）可附加 `strong` 强相关样式
- **右侧固定栏**
  - 顶部展示 `A` 原文
  - 下面按权重降序列出 `B/C/...`
  - 每条 `B/C/...` 用热力条（0~100%）表现强弱
  - 提供按钮：
    - `定位到正文`：滚动到该句并轻提示（闪烁）
    - `设为选中`：将该句切换成新的中心句
- **左侧卡尺**
  - `A` 对应 dot 进入 `is-selected`
  - `B/C/...` 对应 dot 进入 `is-related`（强相关附加 `strong`）
  - dot 可点击：点击 dot 即跳转并设为选中

### 3. 为什么选择 click 而不是 hover

- hover 在真实阅读时容易“扫过即触发”，信息频繁闪动
- click 更稳定，适合用户在阅读中**明确表达关注**，也更接近“建立联系/复盘”的心理动作

## 数据结构（手动标注 / 默认等强）

### DOM 标注（页面内联金句）

推荐把“金句”包裹成一个内联节点：

```html
<span class="gq" data-qid="q1">……金句文本……</span>
```

- `data-qid`：金句唯一标识（后续可用段落 id + offset 生成）

### 关系数据（手动权重）

```js
const QUOTES = {
  q1: { text: "...", links: { q2: 0.75, q3: 0.75 } },
  q2: { text: "...", links: { q1: 0.75, q3: 0.75 } },
  q3: { text: "...", links: { q1: 0.75, q2: 0.75 } },
};
```

说明：

- `text`：用于侧栏展示（真实接入时也可直接从 DOM 取）
- `links`：中心句到其它句的权重（0..1）
- 第一版允许“默认等强”：只要有关联就给同一权重（例如 0.75）

## 视觉表达（热力的两层）

- **正文层（弱提示）**：相关句做“轻高亮”，保证阅读流仍以正文为主
- **侧栏层（强表达）**：用热力条、排序、按钮承载“关系强弱 + 操作”
- **卡尺层（结构感）**：用位置映射回答“相关句分布在哪儿？是否跨段呼应？”

## 可扩展点（不在 MVP 里，但设计上留口）

### 1. 关系类型标签

在关联卡片上加标签，例如：

- **意象呼应**
- **因果**
- **对照/转折**
- **总结/抽象**

第一版可手填，后续再自动识别。

### 2. TopK 策略（防信息爆炸）

当金句很多时：

- 右侧默认只显示 TopK（如 3~5 条）
- 提供“展开更多”

### 3. 自动计算权重（未来）

- embedding cosine similarity
- 关键词共现/TF-IDF
- 情绪/语气相似度

## 接入 DeepRead 的映射建议（后续落地）

### 1. 金句来源

- 来自用户的“划线/收藏”动作
- 每条金句应能定位回 DOM（建议依赖段落 id + 文本 offset 或直接包裹 span 并持久化 selector）

### 2. 卡尺定位

- 在 content script 内可拿到每个金句节点的 `getBoundingClientRect` 与 `scrollY`，映射到文章高度
- viewport window 基于 `scrollY` / `innerHeight` / `documentElement.scrollHeight`

### 3. 状态管理

- `selectedQid` 作为唯一中心状态
- 其余都是衍生状态（related list、样式 class、卡尺点亮）

## 验收清单（你体验时可对照）

- 点击金句后：
  - 正文：中心句高亮、相关句轻高亮
  - 侧栏：出现关联句卡片 + 热力条 + 跳转/设为选中
  - 卡尺：中心刻度突出、相关刻度点亮
- 再点中心句/点击取消：全部恢复默认
- 卡尺 dot 点击：可跳转并设为选中

